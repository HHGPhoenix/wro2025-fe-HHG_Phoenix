import numpy as np
import pandas as pd
from scipy.interpolate import interp1d

# Sample LIDAR data
data = [
(4.171875, 111.0, 54), (4.859375, 111.0, 54), (6.21875, 110.5, 54), (6.890625, 110.5, 54), (7.578125, 111.5, 54), (8.25, 112.0, 54), (8.953125, 112.0, 54), (9.625, 111.0, 54), (12.40625, 111.0, 52), (13.78125, 111.0, 50), (17.859375, 105.0, 40), (19.21875, 102.5, 36), (21.953125, 107.5, 24), (23.328125, 114.0, 18), (24.015625, 117.0, 14), (24.6875, 0.0, 0), (25.375, 97.0, 8), (26.734375, 0.0, 0), (27.40625, 0.0, 0), (28.109375, 220.5, 2), (29.46875, 219.0, 2), (30.140625, 229.0, 2), (31.625, 231.0, 2), (32.328125, 235.5, 2), (33.03125, 238.0, 2), (33.65625, 241.0, 2), (35.015625, 0.0, 0), (35.6875, 0.0, 0), (36.40625, 0.0, 0), (37.09375, 0.0, 0), (37.78125, 487.0, 6), (38.46875, 0.0, 0), (39.8125, 371.0, 4), (44.625, 353.5, 6), (45.984375, 362.5, 6), (46.65625, 366.0, 6), (47.390625, 376.5, 6), (48.078125, 383.0, 6), (48.765625, 0.0, 0), (49.453125, 411.5, 26), (50.140625, 407.5, 28), (50.828125, 404.0, 14), (51.515625, 0.0, 0), (52.203125, 0.0, 0), (52.890625, 0.0, 0), (53.578125, 0.0, 0), (54.265625, 0.0, 0), (54.953125, 0.0, 0), (55.625, 0.0, 0), (56.296875, 0.0, 0), (56.984375, 0.0, 0), (57.65625, 0.0, 0), (58.375, 0.0, 0), (59.0625, 0.0, 0), (59.75, 0.0, 0), (60.4375, 0.0, 0), (61.125, 0.0, 0), (61.8125, 0.0, 0), (62.5, 0.0, 0), (63.1875, 0.0, 0), (63.875, 355.5, 36), (64.5625, 383.0, 38), (67.265625, 371.0, 38), (70.0, 361.0, 40), (71.359375, 357.0, 40), (72.078125, 357.0, 40), (72.765625, 355.0, 40), (74.140625, 352.0, 38), (74.796875, 348.5, 22), (76.828125, 343.0, 14), (77.5625, 0.0, 0), (78.25, 0.0, 0), (78.9375, 289.5, 6), (80.296875, 0.0, 0), (80.96875, 338.5, 38), (83.03125, 338.0, 42), (83.703125, 336.5, 42), (85.765625, 334.5, 34), (91.921875, 337.0, 42), (93.28125, 337.5, 42), (95.34375, 341.0, 42), (96.015625, 342.5, 42), (98.109375, 344.5, 42), (99.46875, 0.0, 0), (100.140625, 0.0, 0), (100.828125, 216.0, 22), (101.5, 211.0, 24), (106.953125, 205.5, 36), (108.96875, 205.0, 34), (109.640625, 206.0, 34), (110.34375, 206.0, 34), (111.015625, 205.5, 34), (111.703125, 207.0, 34), (112.375, 208.0, 34), (113.75, 208.0, 32), (114.4375, 209.5, 32), (115.8125, 213.5, 32), (116.484375, 214.0, 32), (118.53125, 219.0, 32), (119.203125, 221.0, 32), (119.890625, 221.5, 32), (120.5625, 222.0, 28), (121.28125, 0.0, 0), (121.96875, 0.0, 0), (124.015625, 387.0, 24), (124.6875, 389.0, 10), (125.375, 0.0, 0), (126.046875, 0.0, 0), (126.75, 0.0, 0), (132.890625, 214.0, 6), (134.25, 0.0, 0), (136.984375, 362.5, 2), (137.75, 352.0, 2), (138.4375, 371.5, 2), (139.140625, 0.0, 0), (139.828125, 0.0, 0), (140.5, 274.5, 2), (141.1875, 0.0, 0), (142.5625, 0.0, 0), (144.625, 347.0, 4), (145.3125, 340.5, 4), (145.984375, 344.0, 4), (148.734375, 0.0, 0), (149.421875, 198.5, 2), (150.109375, 0.0, 0), (150.796875, 0.0, 0), (152.171875, 197.0, 2), (153.546875, 193.0, 2), (154.21875, 188.0, 2), (154.890625, 192.5, 2), (155.578125, 193.5, 2), (156.25, 192.0, 2), (156.953125, 195.0, 2), (157.625, 199.0, 2), (158.984375, 0.0, 0), (159.6875, 0.0, 0), (161.046875, 0.0, 0), (162.421875, 0.0, 0), (163.78125, 0.0, 0), (165.171875, 260.0, 6), (165.859375, 0.0, 0), (166.546875, 287.0, 4), (167.234375, 262.5, 4), (167.90625, 0.0, 0), (168.578125, 0.0, 0), (169.9375, 0.0, 0), (170.65625, 261.0, 16), (172.03125, 0.0, 0), (172.71875, 277.0, 8), (174.265625, 0.0, 0), (174.984375, 260.5, 4), (177.671875, 250.0, 2), (178.359375, 0.0, 0), (179.0625, 0.0, 0), (179.75, 0.0, 0), (180.4375, 144.0, 2), (181.828125, 0.0, 0), (182.515625, 0.0, 0), (183.203125, 0.0, 0), (185.265625, 0.0, 0), (185.953125, 346.0, 16), (186.640625, 339.5, 22), (189.40625, 0.0, 0), (190.109375, 112.5, 22), (190.796875, 107.5, 28), (192.171875, 104.0, 36), (193.234375, 105.5, 38), (193.859375, 105.0, 38), (195.34375, 105.0, 40), (196.015625, 107.0, 42), (196.703125, 108.5, 44), (198.734375, 112.0, 48), (200.78125, 115.0, 50), (202.140625, 117.5, 48), (202.8125, 0.0, 0), (204.875, 0.0, 0), (205.546875, 98.5, 34), (206.234375, 98.5, 34), (208.265625, 100.5, 38), (208.96875, 0.0, 0), (209.640625, 112.0, 46), (210.328125, 115.0, 48), (211.875, 121.5, 52), (213.328125, 121.5, 52), (214.046875, 121.5, 52), (214.625, 122.0, 52), (215.3125, 123.0, 52), (216.0, 123.5, 52), (216.6875, 124.0, 52), (220.140625, 127.5, 48), (221.515625, 99.5, 44), (223.578125, 101.0, 44), (226.328125, 104.5, 50), (227.703125, 105.5, 52), (229.734375, 107.5, 52), (230.40625, 109.0, 52), (231.125, 110.5, 50), (231.8125, 113.0, 50), (233.1875, 114.5, 48), (233.875, 114.5, 48), (235.9375, 115.0, 52), (237.3125, 114.5, 54), (238.0, 115.5, 54), (241.4375, 116.0, 54), (242.125, 113.5, 54), (242.8125, 113.0, 54), (246.25, 107.5, 52), (246.9375, 107.0, 52), (249.0, 108.5, 54), (249.6875, 108.5, 54), (250.375, 108.0, 54), (251.0625, 109.0, 54), (251.75, 110.0, 54), (253.8125, 111.0, 52), (254.5, 111.0, 52), (255.1875, 112.0, 52), (255.859375, 114.0, 52), (260.6875, 117.0, 52), (262.0625, 117.5, 52), (262.75, 117.0, 52), (263.4375, 118.0, 52), (264.109375, 119.5, 52), (264.78125, 120.0, 52), (269.609375, 119.5, 54), (273.046875, 115.5, 52), (273.734375, 115.5, 52), (275.765625, 114.5, 52), (279.90625, 106.5, 52), (281.96875, 97.0, 48), (284.59375, 117.0, 48), (285.25, 115.0, 48), (286.0, 114.0, 48), (287.359375, 114.5, 50), (288.03125, 115.0, 50), (288.734375, 114.5, 50), (289.40625, 113.5, 50), (290.09375, 112.5, 50), (292.171875, 114.0, 52), (292.859375, 114.0, 52), (293.546875, 114.0, 52), (294.21875, 112.5, 52), (297.625, 114.0, 54), (303.140625, 112.0, 52), (303.828125, 112.0, 52), (306.5625, 113.5, 54), (307.234375, 114.0, 54), (308.640625, 113.5, 54), (310.703125, 115.0, 52), (311.390625, 114.5, 52), (312.078125, 115.0, 52), (312.765625, 116.0, 52), (313.4375, 117.0, 50), (314.109375, 116.0, 50), (315.46875, 116.5, 48), (316.1875, 117.5, 48), (316.875, 117.0, 44), (318.25, 0.0, 0), (319.046875, 0.0, 0), (319.75, 116.5, 16), (320.46875, 116.0, 14), (321.171875, 114.0, 12), (321.796875, 0.0, 0), (323.171875, 0.0, 0), (324.5625, 435.0, 16), (325.25, 435.0, 16), (327.3125, 0.0, 0), (328.0, 965.5, 16), (328.6875, 973.5, 16), (330.078125, 985.0, 18), (331.453125, 965.5, 18), (334.890625, 0.0, 0), (335.453125, 434.5, 20), (338.84375, 409.5, 30), (339.53125, 406.5, 32), (340.203125, 404.5, 32), (340.90625, 400.5, 32), (341.578125, 394.0, 32), (342.265625, 390.0, 32), (343.640625, 393.5, 14), (344.3125, 0.0, 0), (345.671875, 380.0, 26), (346.375, 375.0, 28), (348.40625, 393.0, 4), (349.125, 382.5, 2), (349.8125, 0.0, 0), (350.5, 0.0, 0), (351.84375, 0.0, 0), (353.875, 0.0, 0), (354.59375, 0.0, 0), (355.28125, 0.0, 0), (355.96875, 0.0, 0), (356.65625, 0.0, 0), (358.03125, 0.0, 0), (359.40625, 0.0, 0), (0.078125, 0.0, 0)
]

# Convert to DataFrame for easier manipulation
df = pd.DataFrame(data, columns=["angle", "distance", "intensity"])

# Filter out invalid points (distance and intensity zero)
df = df[(df["distance"] != 0) & (df["intensity"] != 0)]

# Sort the data by angle
df = df.sort_values("angle")

# Define the desired angles (one point per angle from 0 to 360)
desired_angles = np.arange(0, 360, 1)

# Interpolate distance and intensity for missing angles
interp_distance = interp1d(df["angle"], df["distance"], kind="linear", bounds_error=False, fill_value="extrapolate")
interp_intensity = interp1d(df["angle"], df["intensity"], kind="linear", bounds_error=False, fill_value="extrapolate")

# Generate the interpolated values
interpolated_distances = interp_distance(desired_angles)
interpolated_intensities = interp_intensity(desired_angles)

# Create the new DataFrame with interpolated data
interpolated_df = pd.DataFrame({
    "angle": desired_angles,
    "distance": interpolated_distances,
    "intensity": interpolated_intensities
})

# Print the formatted data
print(interpolated_df)

# Save to CSV if needed
# interpolated_df.to_csv("formatted_lidar_data.csv", index=False)
